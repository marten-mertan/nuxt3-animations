var x=Object.defineProperty;var W=(l,s,a)=>s in l?x(l,s,{enumerable:!0,configurable:!0,writable:!0,value:a}):l[s]=a;var m=(l,s,a)=>W(l,typeof s!="symbol"?s+"":s,a);import{r as p,g as k,k as A,j as _,c as S,o as C,l as y,n as g,a as F,_ as $,m as N,b as f,p as w,w as d,d as v}from"./CO2j4tte.js";import{_ as H}from"./rjtqedRv.js";function L(){const l=new Map;class s{constructor(t){m(this,"element");m(this,"spriteSheet");m(this,"frameWidth");m(this,"frameHeight");m(this,"frameCount");m(this,"frameDuration");m(this,"animationName");m(this,"onStart");m(this,"onComplete");m(this,"currentFrame",p(0));m(this,"isAnimating",p(!1));m(this,"isLooping",p(!1));m(this,"animationFrameId",null);m(this,"lastFrameTime",0);this.element=t.element,this.spriteSheet=t.spriteSheet,this.frameWidth=t.frameWidth,this.frameHeight=t.frameHeight,this.frameCount=t.frameCount,this.frameDuration=t.frameDuration,this.animationName=t.animationName,this.onStart=t.onStart||(()=>{}),this.onComplete=t.onComplete||(()=>{}),this.initStyles()}initStyles(){Object.assign(this.element.style,{width:`${this.frameWidth}px`,height:`${this.frameHeight}px`,backgroundRepeat:"no-repeat",position:"relative"})}updateFrame(){this.element.style.backgroundImage=`url(${this.spriteSheet})`,this.element.style.backgroundSize=`${this.frameWidth*this.frameCount}px ${this.frameHeight}px`;const t=-(this.currentFrame.value*this.frameWidth);this.element.style.backgroundPosition=`${t}px 0px`}animate(t){if(this.lastFrameTime||(this.lastFrameTime=t),t-this.lastFrameTime>=this.frameDuration&&(this.currentFrame.value=(this.currentFrame.value+1)%this.frameCount,this.updateFrame(),this.lastFrameTime=t,this.currentFrame.value===0&&!this.isLooping.value)){this.stop(),this.onComplete(this.animationName),this.isAnimating.value=!1;return}this.isAnimating.value&&(this.animationFrameId=requestAnimationFrame(i=>this.animate(i)))}async play(t=!1){if(!this.isAnimating.value&&(this.isAnimating.value=!0,this.isLooping.value=t,this.currentFrame.value=0,this.lastFrameTime=0,this.onStart(this.animationName),this.updateFrame(),this.animationFrameId=requestAnimationFrame(u=>this.animate(u)),!t))return new Promise(u=>{const i=()=>{this.isAnimating.value?requestAnimationFrame(i):(this.onComplete(this.animationName),u())};i()})}stop(){this.animationFrameId!==null&&(cancelAnimationFrame(this.animationFrameId),this.animationFrameId=null),this.isAnimating.value=!1,this.isLooping.value=!1}}return{addAnimation:(a,t)=>{l.set(a,new s({animationName:a,...t}))},playAnimation:async(a,t=!1)=>{const u=l.get(a);if(!u)throw new Error(`Animation ${a} not found`);await u.play(t)},stopAnimation:a=>{const t=l.get(a);t&&t.stop()}}}const M=k({__name:"animator",props:{animations:{},positionStyle:{},isFacingRight:{type:Boolean}},setup(l,{expose:s}){const a=l,t=p(null),{addAnimation:u,playAnimation:i,stopAnimation:e}=L(),r=A(()=>({transform:`scaleX(${a.isFacingRight?-1:1})`})),o=()=>{a.animations.forEach(n=>{const h=new Image;h.src=n.spriteSheet})};return _(()=>{o(),t.value&&(a.animations.forEach(n=>{u(n.name,{element:t.value,spriteSheet:n.spriteSheet,frameWidth:n.frameWidth,frameHeight:n.frameHeight,frameCount:n.frameCount,frameDuration:n.frameDuration,onStart:h=>h!=="idle"&&e("idle"),onComplete:h=>h!=="idle"&&i("idle",!0)})}),i("idle",!0))}),s({playAnimation:i,stopAnimation:e}),(n,h)=>(C(),S("div",{class:g(n.$style.SpriteAnimator),style:y(a.positionStyle)},[F("div",{ref_key:"spriteElement",ref:t,class:g(n.$style.sprite),style:y(r.value)},null,6)],6))}}),b="_SpriteAnimator_ny8uv_8",I="_sprite_ny8uv_15",R={SpriteAnimator:b,sprite:I},E={$style:R},T=$(M,[["__cssModules",E]]);function P({initialX:l=368,initialY:s=236,gridSize:a=64,speed:t=1,boundaries:u={width:800,height:600}}={}){const i=p(l),e=p(s),r=p(!1),o=p(!1),n=A(()=>({transform:`translate(${i.value}px, ${e.value}px)`,transition:"transform 600ms linear"}));return{x:i,y:e,isFacingRight:r,isMoving:o,positionStyle:n,move:D=>{if(o.value)return null;o.value=!0;let c="";switch(D){case"w":e.value-a*t>=0&&(e.value-=a*t,c="walkUp");break;case"s":e.value+a*t<=u.height-a&&(e.value+=a*t,c="walkDown");break;case"a":i.value-a*t>=0&&(i.value-=a*t,c="walkLeft",r.value=!1);break;case"d":i.value+a*t<=u.width-a&&(i.value+=a*t,c="walkRight",r.value=!0);break;default:return o.value=!1,null}return setTimeout(()=>o.value=!1,600),{animationName:c}}}}const U=k({__name:"sprite",setup(l){const s=p(),a=P(),t=async i=>{var r,o;const e=a.move(i);console.log("Move result:",e),e&&(console.log("Playing animation:",e.animationName),await((r=s.value)==null?void 0:r.playAnimation(e.animationName)),console.log("Animation finished, returning to idle"),await((o=s.value)==null?void 0:o.playAnimation("idle",!0)))},u=()=>{var i,e,r,o,n;(i=s.value)==null||i.stopAnimation("walkUp"),(e=s.value)==null||e.stopAnimation("walkDown"),(r=s.value)==null||r.stopAnimation("walkLeft"),(o=s.value)==null||o.stopAnimation("walkRight"),(n=s.value)==null||n.playAnimation("idle",!0)};return _(()=>{const i={KeyW:"w",KeyA:"a",KeyS:"s",KeyD:"d"},e=r=>{const o=r.code,n=o in i?i[o]:void 0;n&&(r.preventDefault(),t(n))};window.addEventListener("keydown",e),N(()=>window.removeEventListener("keydown",e))}),(i,e)=>{const r=T,o=H;return C(),S("div",{class:g([i.$style.SpritePage,"page"])},[f(r,{ref_key:"animator",ref:s,animations:[{name:"idle",spriteSheet:"../img/idle.png",frameWidth:64,frameHeight:128,frameCount:10,frameDuration:100},{name:"walkUp",spriteSheet:"../img/walk.png",frameWidth:64,frameHeight:128,frameCount:6,frameDuration:100},{name:"walkDown",spriteSheet:"../img/walk.png",frameWidth:64,frameHeight:128,frameCount:6,frameDuration:100},{name:"walkLeft",spriteSheet:"../img/walk.png",frameWidth:64,frameHeight:128,frameCount:6,frameDuration:100},{name:"walkRight",spriteSheet:"../img/walk.png",frameWidth:64,frameHeight:128,frameCount:6,frameDuration:100}],"position-style":w(a).positionStyle.value,"is-facing-right":w(a).isFacingRight.value},null,8,["position-style","is-facing-right"]),F("div",{class:g(i.$style.controls)},[f(o,{onClick:e[0]||(e[0]=n=>t("w"))},{default:d(()=>e[4]||(e[4]=[v(" Up ")])),_:1}),f(o,{onClick:e[1]||(e[1]=n=>t("a"))},{default:d(()=>e[5]||(e[5]=[v(" Left ")])),_:1}),f(o,{onClick:e[2]||(e[2]=n=>t("s"))},{default:d(()=>e[6]||(e[6]=[v(" Down ")])),_:1}),f(o,{onClick:e[3]||(e[3]=n=>t("d"))},{default:d(()=>e[7]||(e[7]=[v(" Right ")])),_:1}),f(o,{onClick:u},{default:d(()=>e[8]||(e[8]=[v(" Stop ")])),_:1})],2)],2)}}}),B="_SpritePage_18pm6_8",K="_controls_18pm6_17",q={SpritePage:B,controls:K},V={$style:q},G=$(U,[["__cssModules",V]]);export{G as default};
