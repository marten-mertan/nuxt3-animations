var x=Object.defineProperty;var W=(r,n,a)=>n in r?x(r,n,{enumerable:!0,configurable:!0,writable:!0,value:a}):r[n]=a;var m=(r,n,a)=>W(r,typeof n!="symbol"?n+"":n,a);import{r as f,g as S,j as $,k as C,c as y,o as w,l as k,n as g,a as F,_,m as N,p as H,b as p,q as A,w as d,d as v}from"./9zeDSyTO.js";function M(){const r=new Map;class n{constructor(t){m(this,"element");m(this,"spriteSheet");m(this,"frameWidth");m(this,"frameHeight");m(this,"frameCount");m(this,"frameDuration");m(this,"animationName");m(this,"onStart");m(this,"onComplete");m(this,"currentFrame",f(0));m(this,"isAnimating",f(!1));m(this,"isLooping",f(!1));m(this,"animationFrameId",null);m(this,"lastFrameTime",0);this.element=t.element,this.spriteSheet=t.spriteSheet,this.frameWidth=t.frameWidth,this.frameHeight=t.frameHeight,this.frameCount=t.frameCount,this.frameDuration=t.frameDuration,this.animationName=t.animationName,this.onStart=t.onStart||(()=>{}),this.onComplete=t.onComplete||(()=>{}),this.initStyles()}initStyles(){Object.assign(this.element.style,{width:`${this.frameWidth}px`,height:`${this.frameHeight}px`,backgroundRepeat:"no-repeat",position:"relative"})}updateFrame(){this.element.style.backgroundImage=`url(${this.spriteSheet})`,this.element.style.backgroundSize=`${this.frameWidth*this.frameCount}px ${this.frameHeight}px`;const t=-(this.currentFrame.value*this.frameWidth);this.element.style.backgroundPosition=`${t}px 0px`}animate(t){if(this.lastFrameTime||(this.lastFrameTime=t),t-this.lastFrameTime>=this.frameDuration&&(this.currentFrame.value=(this.currentFrame.value+1)%this.frameCount,this.updateFrame(),this.lastFrameTime=t,this.currentFrame.value===0&&!this.isLooping.value)){this.stop(),this.onComplete(this.animationName),this.isAnimating.value=!1;return}this.isAnimating.value&&(this.animationFrameId=requestAnimationFrame(i=>this.animate(i)))}async play(t=!1){if(!this.isAnimating.value&&(this.isAnimating.value=!0,this.isLooping.value=t,this.currentFrame.value=0,this.lastFrameTime=0,this.onStart(this.animationName),this.updateFrame(),this.animationFrameId=requestAnimationFrame(u=>this.animate(u)),!t))return new Promise(u=>{const i=()=>{this.isAnimating.value?requestAnimationFrame(i):(this.onComplete(this.animationName),u())};i()})}stop(){this.animationFrameId!==null&&(cancelAnimationFrame(this.animationFrameId),this.animationFrameId=null),this.isAnimating.value=!1,this.isLooping.value=!1}}return{addAnimation:(a,t)=>{r.set(a,new n({animationName:a,...t}))},playAnimation:async(a,t=!1)=>{const u=r.get(a);if(!u)throw new Error(`Animation ${a} not found`);await u.play(t)},stopAnimation:a=>{const t=r.get(a);t&&t.stop()}}}const b=S({__name:"animator",props:{animations:{},positionStyle:{},isFacingRight:{type:Boolean}},setup(r,{expose:n}){const a=r,t=f(null),{addAnimation:u,playAnimation:i,stopAnimation:e}=M(),l=$(()=>({transform:`scaleX(${a.isFacingRight?-1:1})`})),o=()=>{a.animations.forEach(s=>{const h=new Image;h.src=s.spriteSheet})};return C(()=>{o(),t.value&&(a.animations.forEach(s=>{u(s.name,{element:t.value,spriteSheet:s.spriteSheet,frameWidth:s.frameWidth,frameHeight:s.frameHeight,frameCount:s.frameCount,frameDuration:s.frameDuration,onStart:h=>h!=="idle"&&e("idle"),onComplete:h=>h!=="idle"&&i("idle",!0)})}),i("idle",!0))}),n({playAnimation:i,stopAnimation:e}),(s,h)=>(w(),y("div",{class:g(s.$style.SpriteAnimator),style:k(a.positionStyle)},[F("div",{ref_key:"spriteElement",ref:t,class:g(s.$style.sprite),style:k(l.value)},null,6)],6))}}),L="_SpriteAnimator_ny8uv_8",U="_sprite_ny8uv_15",B={SpriteAnimator:L,sprite:U},I={$style:B},R=_(b,[["__cssModules",I]]),E="_UiButton_rvqbd_8",T={UiButton:E},P={};function q(r,n){return w(),y("button",{class:g(r.$style.UiButton)},[N(r.$slots,"default")],2)}const K={$style:T},V=_(P,[["render",q],["__cssModules",K]]);function j({initialX:r=368,initialY:n=236,gridSize:a=64,speed:t=1,boundaries:u={width:800,height:600}}={}){const i=f(r),e=f(n),l=f(!1),o=f(!1),s=$(()=>({transform:`translate(${i.value}px, ${e.value}px)`,transition:"transform 600ms linear"}));return{x:i,y:e,isFacingRight:l,isMoving:o,positionStyle:s,move:D=>{if(o.value)return null;o.value=!0;let c="";switch(D){case"w":e.value-a*t>=0&&(e.value-=a*t,c="walkUp");break;case"s":e.value+a*t<=u.height-a&&(e.value+=a*t,c="walkDown");break;case"a":i.value-a*t>=0&&(i.value-=a*t,c="walkLeft",l.value=!1);break;case"d":i.value+a*t<=u.width-a&&(i.value+=a*t,c="walkRight",l.value=!0);break;default:return o.value=!1,null}return setTimeout(()=>o.value=!1,600),{animationName:c}}}}const O=S({__name:"sprite",setup(r){const n=f(),a=j(),t=async i=>{var l,o;const e=a.move(i);console.log("Move result:",e),e&&(console.log("Playing animation:",e.animationName),await((l=n.value)==null?void 0:l.playAnimation(e.animationName)),console.log("Animation finished, returning to idle"),await((o=n.value)==null?void 0:o.playAnimation("idle",!0)))},u=()=>{var i,e,l,o,s;(i=n.value)==null||i.stopAnimation("walkUp"),(e=n.value)==null||e.stopAnimation("walkDown"),(l=n.value)==null||l.stopAnimation("walkLeft"),(o=n.value)==null||o.stopAnimation("walkRight"),(s=n.value)==null||s.playAnimation("idle",!0)};return C(()=>{const i={KeyW:"w",KeyA:"a",KeyS:"s",KeyD:"d"},e=l=>{const o=l.code,s=o in i?i[o]:void 0;s&&(l.preventDefault(),t(s))};window.addEventListener("keydown",e),H(()=>window.removeEventListener("keydown",e))}),(i,e)=>{const l=R,o=V;return w(),y("div",{class:g([i.$style.SpritePage,"page"])},[p(l,{ref_key:"animator",ref:n,animations:[{name:"idle",spriteSheet:"../img/idle.png",frameWidth:64,frameHeight:128,frameCount:10,frameDuration:100},{name:"walkUp",spriteSheet:"../img/walk.png",frameWidth:64,frameHeight:128,frameCount:6,frameDuration:100},{name:"walkDown",spriteSheet:"../img/walk.png",frameWidth:64,frameHeight:128,frameCount:6,frameDuration:100},{name:"walkLeft",spriteSheet:"../img/walk.png",frameWidth:64,frameHeight:128,frameCount:6,frameDuration:100},{name:"walkRight",spriteSheet:"../img/walk.png",frameWidth:64,frameHeight:128,frameCount:6,frameDuration:100}],"position-style":A(a).positionStyle.value,"is-facing-right":A(a).isFacingRight.value},null,8,["position-style","is-facing-right"]),F("div",{class:g(i.$style.controls)},[p(o,{onClick:e[0]||(e[0]=s=>t("w"))},{default:d(()=>e[4]||(e[4]=[v(" Up ")])),_:1}),p(o,{onClick:e[1]||(e[1]=s=>t("a"))},{default:d(()=>e[5]||(e[5]=[v(" Left ")])),_:1}),p(o,{onClick:e[2]||(e[2]=s=>t("s"))},{default:d(()=>e[6]||(e[6]=[v(" Down ")])),_:1}),p(o,{onClick:e[3]||(e[3]=s=>t("d"))},{default:d(()=>e[7]||(e[7]=[v(" Right ")])),_:1}),p(o,{onClick:u},{default:d(()=>e[8]||(e[8]=[v(" Stop ")])),_:1})],2)],2)}}}),X="_SpritePage_18pm6_8",G="_controls_18pm6_17",J={SpritePage:X,controls:G},Q={$style:J},z=_(O,[["__cssModules",Q]]);export{z as default};
