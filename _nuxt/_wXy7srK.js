var L=Object.defineProperty;var E=(r,s,t)=>s in r?L(r,s,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[s]=t;var o=(r,s,t)=>E(r,typeof s!="symbol"?s+"":s,t);import{r as h,g as F,j as $,k as K,l as M,c as x,o as D,n as _,m as A,p as C,a as p,_ as b,b as N}from"./Cwi4Nzdg.js";function P(){const r=new Map;class s{constructor({element:a,spriteSheet:i,frameWidth:e,frameHeight:m,frameCount:l,frameDuration:g,animationName:f,onStart:d=()=>{},onComplete:v=()=>{}}){o(this,"element");o(this,"spriteSheet");o(this,"frameWidth");o(this,"frameHeight");o(this,"frameCount");o(this,"frameDuration");o(this,"animationName");o(this,"onStart");o(this,"onComplete");o(this,"currentFrame",h(0));o(this,"isAnimating",h(!1));o(this,"isLooping",h(!1));o(this,"animationQueue",[]);o(this,"animationFrameId",null);o(this,"lastFrameTime",0);this.element=a,this.spriteSheet=i,this.frameWidth=e,this.frameHeight=m,this.frameCount=l,this.frameDuration=g,this.animationName=f,this.onStart=d,this.onComplete=v,this.initStyles()}initStyles(){Object.assign(this.element.style,{width:`${this.frameWidth}px`,height:`${this.frameHeight}px`,backgroundRepeat:"no-repeat",position:"relative"})}updateFrame(){this.element.style.backgroundImage=`url(${this.spriteSheet})`,this.element.style.backgroundSize=`${this.frameWidth*this.frameCount}px ${this.frameHeight}px`;const a=-(this.currentFrame.value*this.frameWidth);this.element.style.backgroundPosition=`${a}px 0px`}animate(a){if(this.lastFrameTime||(this.lastFrameTime=a),a-this.lastFrameTime>=this.frameDuration&&(this.currentFrame.value=(this.currentFrame.value+1)%this.frameCount,this.updateFrame(),this.lastFrameTime=a,this.currentFrame.value===0&&!this.isLooping.value)){if(this.stop(),this.onComplete(this.animationName),this.isAnimating.value=!1,this.animationQueue.length>0){const e=this.animationQueue.shift();e&&this.play(e.loop).then(e.resolve)}return}this.isAnimating.value&&(this.animationFrameId=requestAnimationFrame(e=>this.animate(e)))}async play(a=!1){return this.isAnimating.value?new Promise(i=>{this.animationQueue.push({resolve:i,loop:a})}):(this.isAnimating.value=!0,this.isLooping.value=a,this.currentFrame.value=0,this.lastFrameTime=0,this.onStart(this.animationName),this.updateFrame(),this.animationFrameId=requestAnimationFrame(i=>this.animate(i)),new Promise(i=>{const e=()=>{this.isAnimating.value?requestAnimationFrame(e):i()};e()}))}stop(){this.animationFrameId!==null&&(cancelAnimationFrame(this.animationFrameId),this.animationFrameId=null),this.isAnimating.value=!1,this.isLooping.value=!1}isBusy(){return this.isAnimating.value}}return{addAnimation:(t,a)=>{r.set(t,new s({animationName:t,...a}))},playAnimation:async(t,a=!1)=>{const i=r.get(t);if(!i)throw new Error(`Animation ${t} not found`);await i.play(a)},stopAnimation:t=>{const a=r.get(t);a&&a.isBusy()&&a.stop()}}}const y=64,k=1,R=6*100,T=F({__name:"spriteAnimator",props:{animations:{}},setup(r,{expose:s}){const t=r,a=h(null),{addAnimation:i,playAnimation:e,stopAnimation:m}=P(),l=h(368),g=h(236),f=h(!1),d=h(null),v=h(!1),I=$(()=>({transform:`translate(${l.value}px, ${g.value}px)`,transition:`transform ${R}ms linear`,width:`${t.animations[0].frameWidth}px`,height:`${t.animations[0].frameHeight}px`,display:"flex",justifyContent:"center",alignItems:"center"})),W=$(()=>({transform:`scaleX(${v.value?-1:1})`,width:"100%",height:"100%"})),H=()=>{t.animations.map(()=>new Image).forEach((n,u)=>{n.src=t.animations[u].spriteSheet})},w=async c=>{if(f.value)return;console.log(`Move triggered: ${c}`),f.value=!0,m("idle");let n;switch(c){case"w":g.value-=y*k,n="walkUp";break;case"s":g.value+=y*k,n="walkDown";break;case"a":l.value-=y*k,n="walkLeft",v.value=!1;break;case"d":l.value+=y*k,n="walkRight",v.value=!0;break;default:f.value=!1;return}d.value=n,await e(n),d.value=null,f.value=!1,S()},S=async()=>{!f.value&&d.value!=="idle"&&(d.value="idle",await e("idle",!0))};return K(()=>{console.log("Component mounted"),H(),a.value?(console.log("Sprite element found"),t.animations.forEach(n=>{i(n.name,{element:a.value,spriteSheet:n.spriteSheet,frameWidth:n.frameWidth,frameHeight:n.frameHeight,frameCount:n.frameCount,frameDuration:n.frameDuration,onStart:u=>{console.log(`${u} started`),u!=="idle"&&m("idle")},onComplete:u=>{console.log(`${u} completed`),u!=="idle"&&!f.value&&S()}})}),S()):console.error("Sprite element not found");const c=n=>{const u=n.code;switch(console.log(`Key pressed: ${u}`),u){case"KeyW":n.preventDefault(),w("w");break;case"KeyA":n.preventDefault(),w("a");break;case"KeyS":n.preventDefault(),w("s");break;case"KeyD":n.preventDefault(),w("d");break}};window.addEventListener("keydown",c),console.log("Keydown listener added"),M(()=>{window.removeEventListener("keydown",c),console.log("Keydown listener removed")})}),s({playAnimation:e,stopAnimation:m,move:w}),(c,n)=>(D(),x("div",{class:A(c.$style.AnimationSpriteAnimator),style:_(C(I))},[p("div",{ref_key:"spriteElement",ref:a,class:A(c.$style.sprite),style:_(C(W))},null,6)],6))}}),B="_AnimationSpriteAnimator_15cdx_7",U="_sprite_15cdx_14",z={AnimationSpriteAnimator:B,sprite:U},Q={$style:z},j=b(T,[["__cssModules",Q]]),q=F({__name:"index",setup(r){const s=h(),t=i=>{var e;(e=s.value)==null||e.move(i)},a=()=>{var i,e,m,l;(i=s.value)==null||i.stopAnimation("walkUp"),(e=s.value)==null||e.stopAnimation("walkDown"),(m=s.value)==null||m.stopAnimation("walkLeft"),(l=s.value)==null||l.stopAnimation("walkRight")};return(i,e)=>{const m=j;return D(),x("div",{class:A(i.$style.IndexPage)},[N(m,{ref_key:"animator",ref:s,animations:[{name:"idle",spriteSheet:"img/idle.png",frameWidth:64,frameHeight:128,frameCount:10,frameDuration:100},{name:"walkUp",spriteSheet:"img/walk.png",frameWidth:64,frameHeight:128,frameCount:6,frameDuration:100},{name:"walkDown",spriteSheet:"img/walk.png",frameWidth:64,frameHeight:128,frameCount:6,frameDuration:100},{name:"walkLeft",spriteSheet:"img/walk.png",frameWidth:64,frameHeight:128,frameCount:6,frameDuration:100},{name:"walkRight",spriteSheet:"img/walk.png",frameWidth:64,frameHeight:128,frameCount:6,frameDuration:100}]},null,512),p("div",{class:A(i.$style.controls)},[p("button",{onClick:e[0]||(e[0]=l=>t("w"))}," Up "),p("button",{onClick:e[1]||(e[1]=l=>t("a"))}," Left "),p("button",{onClick:e[2]||(e[2]=l=>t("s"))}," Down "),p("button",{onClick:e[3]||(e[3]=l=>t("d"))}," Right "),p("button",{onClick:a}," Stop ")],2)],2)}}}),O="_IndexPage_11ny0_7",V="_controls_11ny0_16",X={IndexPage:O,controls:V},G={$style:X},Z=b(q,[["__cssModules",G]]);export{Z as default};
