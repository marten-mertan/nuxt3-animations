import{r as l,u as w,v as k,B as A,c as _,a as C,C as g,s as v,o as S,_ as F,D,b as h,A as y,w as c,d}from"#entry";import{_ as x}from"./B8T7DSbX.js";function W(){const u=new Map;class o{element;spriteSheet;frameWidth;frameHeight;frameCount;frameDuration;animationName;onStart;onComplete;currentFrame=l(0);isAnimating=l(!1);isLooping=l(!1);animationFrameId=null;lastFrameTime=0;constructor(t){this.element=t.element,this.spriteSheet=t.spriteSheet,this.frameWidth=t.frameWidth,this.frameHeight=t.frameHeight,this.frameCount=t.frameCount,this.frameDuration=t.frameDuration,this.animationName=t.animationName,this.onStart=t.onStart||(()=>{}),this.onComplete=t.onComplete||(()=>{}),this.initStyles()}initStyles(){Object.assign(this.element.style,{width:`${this.frameWidth}px`,height:`${this.frameHeight}px`,backgroundRepeat:"no-repeat",position:"relative"})}updateFrame(){this.element.style.backgroundImage=`url(${this.spriteSheet})`,this.element.style.backgroundSize=`${this.frameWidth*this.frameCount}px ${this.frameHeight}px`;const t=-(this.currentFrame.value*this.frameWidth);this.element.style.backgroundPosition=`${t}px 0px`}animate(t){if(this.lastFrameTime||(this.lastFrameTime=t),t-this.lastFrameTime>=this.frameDuration&&(this.currentFrame.value=(this.currentFrame.value+1)%this.frameCount,this.updateFrame(),this.lastFrameTime=t,this.currentFrame.value===0&&!this.isLooping.value)){this.stop(),this.onComplete(this.animationName),this.isAnimating.value=!1;return}this.isAnimating.value&&(this.animationFrameId=requestAnimationFrame(i=>this.animate(i)))}async play(t=!1){if(!this.isAnimating.value&&(this.isAnimating.value=!0,this.isLooping.value=t,this.currentFrame.value=0,this.lastFrameTime=0,this.onStart(this.animationName),this.updateFrame(),this.animationFrameId=requestAnimationFrame(r=>this.animate(r)),!t))return new Promise(r=>{const i=()=>{this.isAnimating.value?requestAnimationFrame(i):(this.onComplete(this.animationName),r())};i()})}stop(){this.animationFrameId!==null&&(cancelAnimationFrame(this.animationFrameId),this.animationFrameId=null),this.isAnimating.value=!1,this.isLooping.value=!1}}return{addAnimation:(a,t)=>{u.set(a,new o({animationName:a,...t}))},playAnimation:async(a,t=!1)=>{const r=u.get(a);if(!r)throw new Error(`Animation ${a} not found`);await r.play(t)},stopAnimation:a=>{const t=u.get(a);t&&t.stop()}}}const N=w({__name:"animator",props:{animations:{},positionStyle:{},isFacingRight:{type:Boolean}},setup(u,{expose:o}){const a=u,t=l(null),{addAnimation:r,playAnimation:i,stopAnimation:e}=W(),m=k(()=>({transform:`scaleX(${a.isFacingRight?-1:1})`})),s=()=>{a.animations.forEach(n=>{const p=new Image;p.src=n.spriteSheet})};return A(()=>{s(),t.value&&(a.animations.forEach(n=>{r(n.name,{element:t.value,spriteSheet:n.spriteSheet,frameWidth:n.frameWidth,frameHeight:n.frameHeight,frameCount:n.frameCount,frameDuration:n.frameDuration,onStart:p=>p!=="idle"&&e("idle"),onComplete:p=>p!=="idle"&&i("idle",!0)})}),i("idle",!0))}),o({playAnimation:i,stopAnimation:e}),(n,p)=>(S(),_("div",{class:v(n.$style.SpriteAnimator),style:g(a.positionStyle)},[C("div",{ref_key:"spriteElement",ref:t,class:v(n.$style.sprite),style:g(m.value)},null,6)],6))}}),H="_SpriteAnimator_ny8uv_8",L="_sprite_ny8uv_15",M={SpriteAnimator:H,sprite:L},b={$style:M},I=F(N,[["__cssModules",b]]);function R({initialX:u=368,initialY:o=236,gridSize:a=64,speed:t=1,boundaries:r={width:800,height:600}}={}){const i=l(u),e=l(o),m=l(!1),s=l(!1),n=k(()=>({transform:`translate(${i.value}px, ${e.value}px)`,transition:"transform 600ms linear"}));return{x:i,y:e,isFacingRight:m,isMoving:s,positionStyle:n,move:$=>{if(s.value)return null;s.value=!0;let f="";switch($){case"w":e.value-a*t>=0&&(e.value-=a*t,f="walkUp");break;case"s":e.value+a*t<=r.height-a&&(e.value+=a*t,f="walkDown");break;case"a":i.value-a*t>=0&&(i.value-=a*t,f="walkLeft",m.value=!1);break;case"d":i.value+a*t<=r.width-a&&(i.value+=a*t,f="walkRight",m.value=!0);break;default:return s.value=!1,null}return setTimeout(()=>s.value=!1,600),{animationName:f}}}}const E=w({__name:"sprite",setup(u){const o=l(),a=R(),t=async i=>{const e=a.move(i);console.log("Move result:",e),e&&(console.log("Playing animation:",e.animationName),await o.value?.playAnimation(e.animationName),console.log("Animation finished, returning to idle"),await o.value?.playAnimation("idle",!0))},r=()=>{o.value?.stopAnimation("walkUp"),o.value?.stopAnimation("walkDown"),o.value?.stopAnimation("walkLeft"),o.value?.stopAnimation("walkRight"),o.value?.playAnimation("idle",!0)};return A(()=>{const i={KeyW:"w",KeyA:"a",KeyS:"s",KeyD:"d"},e=m=>{const s=m.code,n=s in i?i[s]:void 0;n&&(m.preventDefault(),t(n))};window.addEventListener("keydown",e),D(()=>window.removeEventListener("keydown",e))}),(i,e)=>{const m=I,s=x;return S(),_("div",{class:v([i.$style.SpritePage,"page"])},[h(m,{ref_key:"animator",ref:o,animations:[{name:"idle",spriteSheet:"../img/idle.png",frameWidth:64,frameHeight:128,frameCount:10,frameDuration:100},{name:"walkUp",spriteSheet:"../img/walk.png",frameWidth:64,frameHeight:128,frameCount:6,frameDuration:100},{name:"walkDown",spriteSheet:"../img/walk.png",frameWidth:64,frameHeight:128,frameCount:6,frameDuration:100},{name:"walkLeft",spriteSheet:"../img/walk.png",frameWidth:64,frameHeight:128,frameCount:6,frameDuration:100},{name:"walkRight",spriteSheet:"../img/walk.png",frameWidth:64,frameHeight:128,frameCount:6,frameDuration:100}],"position-style":y(a).positionStyle.value,"is-facing-right":y(a).isFacingRight.value},null,8,["position-style","is-facing-right"]),C("div",{class:v(i.$style.controls)},[h(s,{onClick:e[0]||(e[0]=n=>t("w"))},{default:c(()=>[...e[4]||(e[4]=[d(" Up ",-1)])]),_:1}),h(s,{onClick:e[1]||(e[1]=n=>t("a"))},{default:c(()=>[...e[5]||(e[5]=[d(" Left ",-1)])]),_:1}),h(s,{onClick:e[2]||(e[2]=n=>t("s"))},{default:c(()=>[...e[6]||(e[6]=[d(" Down ",-1)])]),_:1}),h(s,{onClick:e[3]||(e[3]=n=>t("d"))},{default:c(()=>[...e[7]||(e[7]=[d(" Right ",-1)])]),_:1}),h(s,{onClick:r},{default:c(()=>[...e[8]||(e[8]=[d(" Stop ",-1)])]),_:1})],2)],2)}}}),T="_SpritePage_18pm6_8",P="_controls_18pm6_17",B={SpritePage:T,controls:P},U={$style:B},V=F(E,[["__cssModules",U]]);export{V as default};
